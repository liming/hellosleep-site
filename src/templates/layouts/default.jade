include ../mixins/flash-messages

doctype html
html(style="position: relative;min-height: 100%;")
  head
    meta(charset="utf-8")
    meta(name="viewport", content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width")
    title= title || '睡吧-和失眠说再见'
    link(rel="shortcut icon", href="/favicon.ico", type="image/x-icon")
    
    link(rel="preload" href="/semantic/semantic.min.css" as="style" onload="this.rel='stylesheet'")
    link(rel="preload" href="/css/dist/style.css" as="style" onload="this.rel='stylesheet'")
    noscript.
      link(rel="stylesheet", href="href="/semantic/semantic.min.css")
      link(rel="stylesheet", href="/css/dist/style.css")
    script.
      !function(e){"use strict";var t=function(t,n,r){function o(e){return i.body?e():void setTimeout(function(){o(e)})}function l(){d.addEventListener&&d.removeEventListener("load",l),d.media=r||"all"}var a,i=e.document,d=i.createElement("link");if(n)a=n;else{var s=(i.body||i.getElementsByTagName("head")[0]).childNodes;a=s[s.length-1]}var u=i.styleSheets;d.rel="stylesheet",d.href=t,d.media="only x",o(function(){a.parentNode.insertBefore(d,n?a:a.nextSibling)});var f=function(e){for(var t=d.href,n=u.length;n--;)if(u[n].href===t)return e();setTimeout(function(){f(e)})};return d.addEventListener&&d.addEventListener("load",l),d.onloadcssdefined=f,f(l),d};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this),function(e){if(e.loadCSS){var t=loadCSS.relpreload={};if(t.support=function(){try{return e.document.createElement("link").relList.supports("preload")}catch(t){}},t.poly=function(){for(var t=e.document.getElementsByTagName("link"),n=0;n<t.length;n++){var r=t[n];"preload"===r.rel&&"style"===r.getAttribute("as")&&(e.loadCSS(r.href,r),r.rel=null)}},!t.support()){t.poly();var n=e.setInterval(t.poly,300);e.addEventListener&&e.addEventListener("load",function(){e.clearInterval(n)})}}}(this);
    
    if user && user.canAccessKeystone
      link(href="/keystone/styles/content/editor.min.css", rel="stylesheet")

    block css
    block head
    
  body(style="font-size: 14px;")
    include ../includes/sidebar_menu

    .pusher(style="display: flex;min-height: 100vh;flex-direction: column;")
      include ../includes/header

      //- intro
      block intro

      .ui.container.main(style="flex: 1;")
        //- messages
        +flash-messages(messages)
        //- content
        block content
        //- footer

      include ../includes/footer
      
    script(async, src='/js/libs/jquery-1.12.2.min.js')
    script(async, src='/semantic/semantic.min.js')
    script(async, src='/js/main.js')
    
    if user && user.canAccessKeystone
      script(src='/keystone/js/content/editor.js')
      
    // The scripts using react
    if section == "tutorial" || section == "share"
      script(async, src='/js/dist.js')
      
    if env == 'production' && ga && ga.property && ga.domain
      script.
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', '#{ga.property}', '#{ga.domain}');
        ga('send', 'pageview');
      
    block page-js
